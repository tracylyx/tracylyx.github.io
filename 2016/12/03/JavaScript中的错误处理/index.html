<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>JavaScript中的错误处理 | tracy木子</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="错误处理 通常要考虑到按照类型、频率或者其他重要的标准对错误进行分类。使得开发人员能够理解用户在使用简单数据库查询或者报告发生脚本时，应用程序可能会出现的问题。
致命错误和非致命错误错误处理策略中最重要的一部分就是：确定错误是否致命。那么，如何区分致命和非致命的错误呢？">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript中的错误处理">
<meta property="og:url" content="http://tracylyx.github.io/2016/12/03/JavaScript中的错误处理/index.html">
<meta property="og:site_name" content="tracy木子">
<meta property="og:description" content="错误处理 通常要考虑到按照类型、频率或者其他重要的标准对错误进行分类。使得开发人员能够理解用户在使用简单数据库查询或者报告发生脚本时，应用程序可能会出现的问题。
致命错误和非致命错误错误处理策略中最重要的一部分就是：确定错误是否致命。那么，如何区分致命和非致命的错误呢？">
<meta property="og:updated_time" content="2016-12-21T16:32:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript中的错误处理">
<meta name="twitter:description" content="错误处理 通常要考虑到按照类型、频率或者其他重要的标准对错误进行分类。使得开发人员能够理解用户在使用简单数据库查询或者报告发生脚本时，应用程序可能会出现的问题。
致命错误和非致命错误错误处理策略中最重要的一部分就是：确定错误是否致命。那么，如何区分致命和非致命的错误呢？">
  
    <link rel="alternate" href="/atom.xml" title="tracy木子" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">tracy木子</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">博客小站</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://tracylyx.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-JavaScript中的错误处理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/03/JavaScript中的错误处理/" class="article-date">
  <time datetime="2016-12-03T06:04:08.000Z" itemprop="datePublished">2016-12-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JavaScript中的错误处理
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>错误处理</strong> 通常要考虑到按照类型、频率或者其他重要的标准对错误进行分类。使得开发人员能够理解用户在使用简单数据库查询或者报告发生脚本时，应用程序可能会出现的问题。</p>
<p>致命错误和非致命错误<br>错误处理策略中最重要的一部分就是：<strong>确定错误是否致命</strong>。那么，如何区分致命和非致命的错误呢？</p>
<a id="more"></a>
<ul>
<li><p>非致命判断条件：</p>
<ol>
<li>不影响用户的主要功能</li>
<li>只影响页面的一部分</li>
<li>可以恢复</li>
<li>重复相同操作可以消除错误</li>
</ol>
</li>
<li><p>致命错误判断条件：</p>
<ol>
<li>应用程序根本无法继续运行</li>
<li>错误明显影响了用户的主要操作</li>
<li>会导致其他连带错误</li>
</ol>
</li>
</ul>
<p>try-catch 语句：当 try 中的代码发生了任何错误，会立即退出代码执行过程然后执行 catch<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	<span class="comment">// 需要做异常处理的代码，有可能抛出错误的代码</span></div><div class="line">&#125; <span class="keyword">catch</span> (error) &#123; <span class="comment">// 包含错误信息的对象，你即使不使用这个对象也要给它命名</span></div><div class="line">	<span class="comment">// 当出现异常的时候会抛出错误</span></div><div class="line">&#125; <span class="keyword">finally</span> &#123;</div><div class="line">	<span class="comment">// finally是可选的</span></div><div class="line">	<span class="comment">// 如果存在finally 无论是try 还是catch 都会走finally</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> testTryCatch = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	&#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">testTryCatch(); <span class="comment">// 1</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> testFinally = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">	&#125; <span class="keyword">catch</span> (error) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">	&#125; <span class="keyword">finally</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">3</span>;</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">testFinally(); <span class="comment">// 3 因为有finally语句块</span></div></pre></td></tr></table></figure></p>
<p>try-catch 使用：在编写 JavaScript 库 或是 多出使用的辅助方法的时候，善用 try-catch ，万一有错误发生了，通过他们可以获取很大的帮助</p>
<p>错误类型<br>代码执行过程中可能发生的错误有多种类型。每种错误都有对应的错误类型，当错误发生时，就会抛出相应的错误对象。目前有<strong>7种</strong>错误类型：</p>
<ul>
<li>Error 基类型，其他类型都是继承自该类型，主要目的是提供开发人员抛出自定义错误</li>
<li>EvalError 使用 eval() 函数而发生异常时抛出</li>
<li>RangeError 数值超出相应范围时触发</li>
<li>RefenceError  找不到对象的情况下触发</li>
<li>SyntaxError 语法错误的js字符串传入 eval() 时触发</li>
<li>TypeError  变量中保存着意外的类型时，或 访问不存在的方法时。归根：执行特定的类型操作时，变量的类型并不符合要求所致 </li>
<li>URIError 使用decodeURI() 或 encodeURI() 时，URI格式不正确</li>
</ul>
<p>可知，通过 instanceof 可以判断错误的类型<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> isRengenceError = error <span class="keyword">instanceof</span> RengenceError;</div></pre></td></tr></table></figure></p>
<p>throw 抛出错误<br>与 try-catch 语句配合使用的还有一个 throw 操作符，用于随时抛出自定义的错误。当抛出错误时，必须要给 throw 操作符一个指定的值，至于值是什么类型，没有具体要求。<br>当遇到 throw 操作符的时候，代码会立刻停止执行。当且仅当有 try-catch 语句捕获到抛出的值时，代码才会继续执行。</p>
<p>错误处理策略<br>考虑的方面：工具（记录和监控系统）用于分析错误模式，追查错误原因，同事帮助确定错误会影响多少用户。需要知道代码何时可能出错，会出什么错，同时还需要一个跟踪此类问题的系统。</p>
<p>由于js是松散类型的，常见的容易出错的三种错误：</p>
<ol>
<li><p>类型转换错误<br>发生在某个操作符，或者使用其他可能会自动转化值的数据类型的语言结构时。流程控制语句中使用非布尔值，是一种极为常见的错误来源。为避免此类错误：要做到条件比较时切实传入布尔值。<br>代码示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 错误的做法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">contact</span> (<span class="params">str1, str2, str3</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> result = str1 + str2;</div><div class="line"></div><div class="line">	<span class="comment">// 因为0 和 undefined 都将转为 false</span></div><div class="line">	<span class="keyword">if</span> (str3) &#123;</div><div class="line">		result += str3;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div><div class="line"></div><div class="line">contact(<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="number">0</span>); <span class="comment">// '12' 这种情况为第三个参数为0，在if中杯转换成false</span></div><div class="line">contact(<span class="string">'1'</span>, <span class="string">'2'</span>); <span class="comment">// '12' 这种情况为第三个参数为undefined，在if中杯转换成false</span></div><div class="line"></div><div class="line"><span class="comment">// 正确做法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">contact</span> (<span class="params">str1, str2, str3</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> result = str1 + str2;</div><div class="line"></div><div class="line">	<span class="comment">// 对条件进行恰当判断</span></div><div class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> str3 === <span class="string">'string'</span>) &#123;</div><div class="line">		result += str3;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>数据类型错误<br>松散类型的 js ，导致在使用变量和函数参数之前，不会对他们进行比较以确保他们的数据类型正确。将意料之外的值传入函数时，最容易发生数据类型错误。<br>代码示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 错误的做法</span></div><div class="line"><span class="comment">// 不安全的函数，任何非字符串值都会导致错误</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getQueryString</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> pos = url.indexOf(<span class="string">'?'</span>);</div><div class="line"></div><div class="line">	<span class="comment">// 返回？之后的内容</span></div><div class="line">	<span class="keyword">if</span> (pos) &#123;</div><div class="line">		<span class="keyword">return</span> url.substring(pos + <span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="string">''</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 正确的做法</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getQueryString</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">'string'</span>) &#123; <span class="comment">// 通过检查类型确保安全</span></div><div class="line">		<span class="keyword">var</span> pos = url.indexOf(<span class="string">'?'</span>);</div><div class="line"></div><div class="line">		<span class="comment">// 返回？之后的内容</span></div><div class="line">		<span class="keyword">if</span> (pos) &#123;</div><div class="line">			<span class="keyword">return</span> url.substring(pos + <span class="number">1</span>);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> <span class="string">''</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>通信错误<br>js与服务器之间的任何一次通信，都有可能产生错误。可能与格式不正确的URL或发送的数据有关，最常见的是在将数据发送给服务器之前没有使用 encodeURIComponent() 对数据进行编码。<br>示例代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 为避免通信错误，我们可以提供一个</div><div class="line">// 处理字符串中搜索部分处理的辅助函数</div><div class="line">function addQueryStringArg (url, name, value) &#123;</div><div class="line">	if (typeof url === &apos;string&apos;) &#123;</div><div class="line">		url += url.indexOf(&apos;?&apos;) &gt; 0 ? &apos;&apos; : &apos;?&apos;;</div><div class="line"></div><div class="line">		var queryPart = &apos;&amp;&apos; + name + &apos;=&apos; + &apos;value&apos;;</div><div class="line"></div><div class="line">		queryPart = encodeURIComponent(queryPart);</div><div class="line"></div><div class="line">		return url += queryPart;</div><div class="line">	&#125; else &#123;</div><div class="line">		throw (&apos;请输入 url 且为字符串&apos;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>已上错误分别会在特定的模式下或者没有对值进行足够的检查时发生。<br>为了增强值得健壮性，需要对传入的参数进行充分的判断，从而避免在条件语句中出现因为类型转换导致的错误，也避免因为没有对传入数据的类型进行充分判断而导致 TypeError 的错误提示。</p>
<p>总结：错误处理在项目中开发有其不可缺少的作用。在开发 js 的过程中，重点关注函数和可能导致函数执行失败的因素。良好的错误处理机制应该可以确保代码中只发生你自己抛出的错误。<br>自己在开发过程中很少使用错误处理，最多的是在数据类型判断、条件判断出现预期之外的结果时，通过 console.log 在控制台输出一些信息，给调试过程使用。今后，可以在必要的地方加上 try-catch 语句来进行错误处理。<br>现在参与过的前端项目，前端日志这块基本为0，每当有用户反馈一些奇奇怪怪、测试、开发无法复现的 bug 时，自己就懵圈了，其实可以这样：通过 ubt 进行关键节点埋点，如果关键节点出现问题了，将信息推送给 ubt，这样当用户反馈问题时，可以有个比较好的错误反馈，帮助排查问题进而解决问题。</p>
<p>文章是《JavaScript高级程序设计》的阅读笔记，具体可以翻阅此书。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://tracylyx.github.io/2016/12/03/JavaScript中的错误处理/" data-id="cix1npr7h00013jujylz21g3o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/12/22/canvas学习笔记/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          canvas学习笔记
        
      </div>
    </a>
  
  
    <a href="/2016/11/26/使用hexo搭建博客简单教程/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">使用hexo搭建博客简单教程</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/canvas/" style="font-size: 10px;">canvas</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/12/22/canvas学习笔记/">canvas学习笔记</a>
          </li>
        
          <li>
            <a href="/2016/12/03/JavaScript中的错误处理/">JavaScript中的错误处理</a>
          </li>
        
          <li>
            <a href="/2016/11/26/使用hexo搭建博客简单教程/">使用hexo搭建博客简单教程</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>